# 段階的な実装計画

## フェーズ1：APIサーバーの雛形構築
- FastAPI（またはFlask）でプロジェクトの初期セットアップ
- `/search`, `/add`, `/update`, `/delete` のエンドポイントをダミー実装（レスポンスのみ返す）
- Dockerfile作成・コンテナ起動確認

## フェーズ2：認証・認可の導入
- APIキーまたはJWTによる認証機能の追加
- 認証失敗時のエラーハンドリング

## フェーズ3：PostgreSQL（pgvector）連携
- DB接続（SQLAlchemy/psycopg2）実装
- ベクトルデータの追加・更新・削除・検索の基本SQL実装
- pgvectorの`<->`演算子を用いたベクトル検索

## フェーズ4：レスポンス整形・エラーハンドリング
- 検索結果や操作結果のレスポンスフォーマット統一
- エラー時のレスポンス設計

## フェーズ5：ログ・監査機能
- APIアクセスログの記録
- 操作履歴の保存・監査用エンドポイント（必要に応じて）

## フェーズ6：拡張性・汎用化
- ベクトルDB種類変更に備えた抽象化（DBラッパー/インターフェース設計）
- Dify以外のクライアント対応（CORS設定等）

## フェーズ7：テスト・運用
- ユニットテスト・統合テストの追加
- Dify連携テスト
- CI/CDパイプライン（必要に応じて）

---

各フェーズは「APIエンドポイントごと」「認証方式ごと」「DB操作ごと」など、機能単位で細かく分割して進めると、進捗管理やレビューがしやすくなります。
まずは雛形・認証・DB連携までを最小構成で動かし、その後レスポンス整形や監査、拡張性対応を追加していく流れが効率的です。
